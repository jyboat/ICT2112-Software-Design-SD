@model ClearCare.Models.Entities.M3T1.Resource

@{
	ViewData["Title"] = "Update Resource";
}

@if (Model == null)
{
	<div class="alert alert-danger">Error: Resource not found.</div>
}
else
{
	var resource = Model.getDetails();
	string currentType = resource["Url"].ToString().ToLower().EndsWith(".mp4") ? "video" : "article";
	string currentUrl = resource["Url"].ToString();
	<div class="container update-resource">
		<div class="card card-body">
			<h3 class="text-info font-weight-bold">Update Resource</h3>
			<form method="post" action="/Resource/Edit/@resource["Id"]" enctype="multipart/form-data">
				<input type="hidden" name="resourceType" value="@currentType" />
				<div class="row">
					<div class="col-lg-9">
						<div class="md-form md-outline">
							<label for="title">Title</label>
							<input class="form-control w-50" type="text" name="title" id="title" value="@resource["Title"]"
								required>
						</div>
						<div class="md-form md-outline">
							<label for="description">Description</label>
							<textarea class="form-control" id="description" name="description" rows="7"
								required>@resource["Description"]</textarea>
						</div>

						@if (currentType == "article")
						{
							<div class="md-form md-outline">
								<label for="url">Article Link</label>
								<input class="form-control w-50" type="url" name="url" id="url" value="@currentUrl" required />
							</div>
						}
						else if (currentType == "video")
						{
							<div class="mt-2">
								<label for="videoFile">Upload a New Video (optional)</label>
								<input type="file" name="videoFile" accept=".mp4" id="videoFile" />
								<input type="hidden" name="existingUrl" value="@currentUrl" />
								<small class="text-muted">Current video: @currentUrl.Split('/').Last()</small>
							</div>
						}
					</div>
					<div class="col-lg-3">
						<label class="fst-italic">Cover Image (Optional)</label>
						<div class="custom-file">
							<div class="files-upload" data-autosubmit="false">
								<div class="wrapper">
									<div class="card-text">
										<i class="bi bi-5x bi-card-image"></i>
										<p class="font-weight-bolder">Current Cover</p>
									</div>
									<div class="preview">
										<img class="poster"
											src="data:image/jpeg;base64,@Convert.ToBase64String((byte[])resource["CoverImage"])" />
										<div class="infos d-none">
											<div class="infos-inner">
												<p class="filename"></p>
												<a type="button" class="btn btn-sm btn-success">Change image</a>
											</div>
										</div>
									</div>
									<button type="button" class="remove btn btn-sm btn-danger d-none">Remove</button>
								</div>
								<input type="file" name="coverImage" accept="image/png,image/jpeg,image/jpg,image/gif">
							</div>
						</div>
					</div>
				</div>
				<a href="/Resource" class="btn btn-danger">Cancel</a>
				<button type="submit" class="btn btn-success">Update</button>
			</form>
		</div>
	</div>

	<script src="~/js/previewFile.js" asp-append-version="true"></script>
}
