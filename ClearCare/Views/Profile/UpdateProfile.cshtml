@model ClearCare.Models.Entities.User

@{
    ViewData["Title"] = "Edit Profile";
    var profileData = Model.getProfileData();
    var countryCodes = new List<string> { "65", "60", "66", "62" }; // new code added for country code
    @* var selectedCode = profileData["MobileNumber"]?.ToString(); // new code added for country code *@
    var selectedCode = profileData["MobileNumber"]?.ToString()?.Substring(0, 2); // new code added for country code
    var actualMobile = profileData["MobileNumber"]?.ToString()?.Substring(2); // new code added for country code

}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/css/site.css">
</head>

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-0 rounded-3"> 
                <div class="card-header bg-gradient bg-primary text-white p-4">
                    <h2 class="text-center mb-0">@ViewData["Title"]</h2>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-warning text-center mb-4">
                        <strong>Disclaimer:</strong><br>Ensure all fields are filled correctly.
                    </div>

                    <!-- Toastr Message-->
                    <input type="hidden" id="ToastrSuccessMessage" value="@TempData["SuccessMessage"]" />
                    <input type="hidden" id="ToastrErrorMessage" value="@TempData["ErrorMessage"]" />

                    <form method="post" asp-controller="Profile" asp-action="updateProfile">
                        <div class="row g-3">
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="email" name="email" class="form-control shadow-sm" value="@profileData["Email"]" required />
                                    <label class="bi bi-envelope me-1"> Email</label>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="text" name="name" class="form-control shadow-sm" value="@profileData["Name"]" required />
                                    <label class="bi bi-person me-1"> Name</label>
                                </div>
                            </div>

                            @* <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="number" name="countryCode" class="form-control shadow-sm" value="@profileData["CountryCode"]" required /> 
                                    <label class="bi bi-telephone me-1"> Country Code</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="number" name="mobileNumber" class="form-control shadow-sm" value="@profileData["MobileNumber"]" required />
                                    <label class="bi bi-telephone me-1"> Mobile Number</label>
                                </div>
                            </div> *@

                            @* <div class="row">
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                    <input type="number" name="countryCode" class="form-control shadow-sm"
                                            value="@profileData["CountryCode"]" required />
                                    <label class="bi bi-telephone me-1">Country Code</label>
                                    </div>
                                </div>

                                <div class="col-md-8">
                                    <div class="form-floating mb-3">
                                    <input type="number" name="mobileNumber" class="form-control shadow-sm"
                                            value="@profileData["MobileNumber"]" required />
                                    <label class="bi bi-telephone me-1">Mobile Number</label>
                                    </div>
                                </div>
                            </div> *@

                            <!-- bew Code form countryCode -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        <select name="countryCode" class="form-select shadow-sm" required>
                                            @foreach (var code in countryCodes)
                                            {
                                                var selectedAttr = code == selectedCode ? "selected" : "";
                                                @:<option value="@code" @selectedAttr>@code</option>
                                            }
                                        </select>

                                        <label class="bi bi-telephone me-1">Country Code</label>
                                    </div>
                                </div>

                                <div class="col-md-8">
                                    <div class="form-floating mb-3">
                                        <input type="number" name="mobileNumber" class="form-control shadow-sm"
                                            value="@actualMobile" required />
                                        <label class="bi bi-telephone me-1">Mobile Number</label>
                                    </div>
                                </div>
                            </div>
                            <!-- bew Code form countryCode -->

                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="text" name="address" class="form-control shadow-sm" value="@profileData["Address"]" required />
                                    <label class="bi bi-geo-alt me-1"> Address</label>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="password" name="newpassword" class="form-control shadow-sm" placeholder="Leave blank to keep current password" />
                                    <label class="bi bi-asterisk me-1"> New Password</label>
                                </div>
                            </div>

                             <div class="col-12">
                                <div class="form-floating mb-3">
                                    <input type="password" name="confirmpassword" class="form-control shadow-sm" placeholder="Leave blank to keep current password" />
                                    <label class="bi bi-asterisk me-1"> Confirm Password</label>
                                </div>
                            </div>
                            
                            @if (profileData["DateOfBirth"] is Google.Cloud.Firestore.Timestamp ts)
                            {
                                var dobUtc = ts.ToDateTime();
                                var dobLocal = dobUtc.AddHours(8).ToString("yyyy-MM-dd");

                                <div class="form-floating mb-3">
                                    <input type="date" name="dateOfBirth" id="dateOfBirth" class="form-control shadow-sm" value="@dobLocal" placeholder="Date of Birth" required />
                                    <label for="dateOfBirth" class="bi bi-calendar me-1"> Date of Birth</label>
                                </div>
                            }

                        </div>
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary w-100 py-2 shadow">
                                <i class="bi bi-save"></i> Save Changes
                            </button>
                            <a class="btn btn-secondary w-100 py-2 mt-2 shadow" asp-controller="Profile" asp-action="displayProfile">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
