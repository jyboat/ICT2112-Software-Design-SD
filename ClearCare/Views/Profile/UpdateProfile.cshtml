@model ClearCare.Models.Entities.User

@{
    ViewData["Title"] = "Edit Profile";
    var profileData = Model.GetProfileData();
}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/css/site.css">
</head>

<div class="container py-5">
    <div class="mx-auto bg-white rounded-3 shadow p-4" style="max-width: 600px;">
        <h1 class="text-center mb-3 text-warning fw-bold">@ViewData["Title"]</h1>

        <div class="alert alert-warning text-center rounded-pill">
            <strong>Disclaimer:</strong><br>Ensure all fields are filled correctly.
        </div>

        <form method="post" asp-controller="Profile" asp-action="updateProfile">
            <div class="mb-3">
                <label class="form-label fw-bold">Email</label>
                <input type="email" name="email" class="form-control rounded-pill shadow-sm" value="@profileData["Email"]" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Name</label>
                <input type="text" name="name" class="form-control rounded-pill shadow-sm" value="@profileData["Name"]" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Mobile Number</label>
                <input type="number" name="mobileNumber" class="form-control rounded-pill shadow-sm" value="@profileData["MobileNumber"]" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Address</label>
                <input type="text" name="address" class="form-control rounded-pill shadow-sm" value="@profileData["Address"]" required />
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">New Password</label>
                <input type="password" name="password" class="form-control rounded-pill shadow-sm" placeholder="Leave blank to keep current password" />
            </div>

            @if (profileData.ContainsKey("Specialization"))
            {
                <div class="mb-3">
                    <label class="form-label fw-bold">Specialization</label>
                    <input type="text" name="specialization" class="form-control rounded-pill shadow-sm" value="@profileData["Specialization"]" />
                </div>
            }
            @if (profileData.ContainsKey("Department"))
            {
                <div class="mb-3">
                    <label class="form-label fw-bold">Department</label>
                    <input type="text" name="department" class="form-control rounded-pill shadow-sm" value="@profileData["Department"]" />
                </div>
            }
            @if (profileData.ContainsKey("DateOfBirth"))
            {
                // Convert stored UTC timestamp to "yyyy-MM-ddTHH:mm" format for datetime-local input
                DateTime dobUtc = DateTime.Parse(profileData["DateOfBirth"].ToString());
                string dobLocal = dobUtc.ToString("yyyy-MM-ddTHH:mm"); // Convert to HTML5 datetime-local format

                <label class="form-label fw-bold">Date of Birth</label>
                <input type="datetime-local" name="dateOfBirth" class="form-control" value="@dobLocal" required />
            }

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success w-100 py-2 rounded-pill shadow">
                    <i class="bi bi-save"></i> Save Changes
                </button>
                <a class="btn btn-secondary w-100 py-2 mt-2 rounded-pill shadow" asp-controller="Profile" asp-action="displayProfile">
                    <i class="bi bi-arrow-left"></i> Cancel
                </a>
            </div>
        </form>
    </div>
</div>
