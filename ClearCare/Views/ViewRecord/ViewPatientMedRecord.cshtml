@{
    var medicalRecords = ViewData["PersonalMedicalRecords"] as List<dynamic>;

    @* 
@if (medicalRecords == null)
{
    <p style="color: red;">ViewData["PersonalMedicalRecords"] is NULL!</p>
}
else
{
    <p style="color: green;">ViewData contains @medicalRecords.Count records.</p>
}
*@

}


<h2 class="mb-4 text-primary">My Medical Records</h2>

<div class="mb-3 d-flex justify-content-between">
    <input type="text" id="searchInput" class="form-control w-50" placeholder="Search medical records..."
        onkeyup="searchTable()">
</div>

@if (medicalRecords != null && medicalRecords.Count > 0)
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th onclick="sortTable(0)" style="cursor: pointer;">Date</th>
                    <th onclick="sortTable(1)" style="cursor: pointer;">Doctor's Note</th>
                    <th>Attachment Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="recordsTable">
                @foreach (var record in medicalRecords)
                {
                    <tr>
                        <td>@record.Date</td>
                        <td>@record.DoctorNote</td>
                        <td>@record.AttachmentName</td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm" onclick="showNotes('@record.DoctorNote')">

                                View Notes
                            </button>
                        </td>
                    </tr>
                }
            </tbody>

        </table>
    </div>

    <!-- Pagination Controls -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <button id="prevPage" class="btn btn-secondary" onclick="prevPage()">Previous</button>
        <span id="pageIndicator" class="mx-3"></span>
        <button id="nextPage" class="btn btn-secondary" onclick="nextPage()">Next</button>
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Doctor's Note</th>
                    <th>Attachment Name</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="3" class="text-center text-muted">No medical records found.</td>
                </tr>
            </tbody>
        </table>
    </div>
}

<!-- Modal for Doctor's Notes -->
<div class="modal fade" id="notesModal" tabindex="-1" aria-labelledby="notesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="notesModalLabel">Doctor's Notes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="notesContent">
                <!-- Notes will be dynamically inserted here -->
            </div>
        </div>
    </div>
</div>
